# 🧾 仕様変更 実装計画

## 🧩 目的

- Explorer から同期ボタンで `.codex` と同期フォルダの相互同期を実行できるようにする。

## 🔍 変更要件整理

- 同期先フォルダ設定（既定値はブランク）を追加する。
  - `codexFolder`
  - `promptsFolder`
  - `skillsFolder`
  - `templatesFolder`
- Codex Core / Prompts / Skills / Templates に同期ボタン（codicon: `sync`）を追加する。
- 同期先フォルダが未設定の場合は同期ボタンを非表示にする。
- 同期時は確認メッセージを表示し、OK の場合のみ相互同期を実行する。
- 同名ファイルは最終更新日時が新しい方を正として古い方を上書きする。
- いずれかで削除されたファイルは両方から削除する。
- 削除同期の判定に必要なメタ情報は `.codex/.codex-sync` に保存し、削除が両方に反映された時点で削除する。
- `.codex/.codex-sync` 配下は隠しフォルダとして同期対象外とする。
- 隠しフォルダ/隠しファイルは同期対象外とする。
- 上書き中にエラーが発生した場合は該当ファイルのみスキップし、簡易ダイアログで通知する。

## 🛠️ 実装タスク

- 設定スキーマ追加と設定値取得ユーティリティの整備。
- 同期コマンドの登録と view/title ボタンの追加。
- Explorer ごとの同期処理（対象ファイル列挙、相互同期、確認ダイアログ）。
- ローカライズ文言の追加（確認/スキップ通知メッセージ）。
- 削除同期メタ情報の保存/削除の追加。
- 単体/統合テストの追加。

## 🧾 Issue 一覧

- CONFIG-001: 同期先フォルダ設定の追加
- UI-001: 同期ボタンとコマンドの追加
- SYNC-001: 同期コピー処理の実装
- TEST-001: 同期機能のテスト追加

## ✅ 受け入れ基準

- 設定値が空の場合、各 Explorer の同期ボタンが表示されない。
- 同期ボタン押下時に確認ダイアログが表示され、OK の場合のみ相互同期が実行される。
- Codex Core は `.codex/AGENTS.md` と `.codex/config.toml` を相互同期する。
- Prompts / Skills / Templates は各ルート配下のファイルを相互同期する。
- 同名ファイルは最終更新日時が新しい方を正として古い方を上書きする。
- いずれかで削除されたファイルは両方から削除される。
- 削除同期の判定に必要なメタ情報は `.codex/.codex-sync` に保存され、削除が両方に反映された時点で削除される。
- `.codex/.codex-sync` 配下は隠しフォルダとして同期対象外である。
- 隠しフォルダ/隠しファイルは同期対象外である。
- 上書き中のエラーは該当ファイルのみスキップし、通知される。
- 同期機能のテストが追加される。

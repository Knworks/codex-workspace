# 🧾`BASE-001 利用可否判定と共通ガード基盤`

## 🎯背景/目的

- `~/.codex` や `config.toml` が壊れている状態で誤操作が起きないよう、全ビューで共通の利用可否判定と操作ガードを整備する。

## 📌要件

- 5.2
- 5.3
- 6（ユーザビリティ: 未選択時メッセージ）

## 🛠️スコープ / 作業内容

- `src/extension.ts` の登録フローを拡張し、共通ガードを呼び出す
- `~/.codex`/`config.toml` の存在・読取・TOML パースを判定するサービスを追加（例: `src/services/workspaceStatus.ts`）
- 利用不可時は各ビューに同一のエラーノードを1件だけ返す
- UI/イベント/保存先: コマンド/クリック時に選択必須チェック → 未選択なら通知（保存先なし）
- 参照: `docs/01_requirements.md`, `docs/02_architect.md`

## ✅AC（受け入れ基準）

- [ ] [機能] `~/.codex` か `config.toml` が欠落/読取不可/パース不可の場合、各ビューに `? Codex Workspace を開けません: <理由>` が1件のみ表示される
- [ ] [状態/エラー] 利用不可状態では全コマンドが実行されず、ファイル操作が発生しない
- [ ] [UI/UX] 対象未選択で操作した場合、通知メッセージが表示される
- [ ] [テスト] 利用可否判定の主要ケースがユニットテストで検証できる

## 🔗依存関係

- DependsOn: なし

## 🧪テスト観点

- (ユニット)
- 検証方法：`npm test` で利用可否判定のケース別テストを実行


---
id: `TEST-001`
title: `仕様変更分テスト整備`
status: Todo
---

# 🧾`TEST-001 仕様変更分テスト整備`

## 🎯背景/目的

- 追加仕様（Agent管理、メタ移行、テンプレート運用維持）の回帰を防止し、変更後の安定運用を担保する。

## 📌要件

- Agent ExplorerとAgentフロー（追加/編集/削除/有効無効）をテストで検証する。
- Agentファイル同期フロー（`agentFolder`、同期ボタン表示条件、相互同期）をテストで検証する。
- `config.toml`の`[agents.<agent>]`追記・削除・復元ロジックをテストで検証する。
- 同期メタ移行（旧→新）と失敗時挙動をテストで検証する。

## 🛠️スコープ / 作業内容

- Agent一覧取得、追加ウィザード、重複エラー、テンプレート適用のユニット/統合テストを追加する。
- Agent同期（更新日時優先、削除同期、隠し除外、エラースキップ）のユニット/統合テストを追加する。
- `agents-disabled.json`退避/復元、最小構成フォールバックのテストを追加する。
- 同期メタの優先読み取り、原子的移行、失敗時中断のテストを追加する。
- `.codex/codex-templates`継続利用（自動移動・自動削除なし）の回帰テストを追加する。

## ✅AC（受け入れ基準）

- AC：必要十分な項目数（最低3、目安5〜10、上限なし）
  - [ ] [テスト] Agent Explorerの一覧/選択/アイコン切替がテストで検証できる
  - [ ] [テスト] Agent追加フロー（名前/説明/テンプレート）と重複中断がテストで検証できる
  - [ ] [テスト] Agent同期のボタン表示条件と相互同期処理がテストで検証できる
  - [ ] [テスト] `config.toml`の`[agents.<agent>]`追記・非上書き通知がテストで検証できる
  - [ ] [テスト] Agent無効化時の退避（コメント保持）と有効化時復元がテストで検証できる
  - [ ] [テスト] 同期メタの新旧読取優先順と原子的移行がテストで検証できる
  - [ ] [テスト] 移行失敗時に旧メタ保持・中断となることがテストで検証できる
  - [ ] [テスト] `.codex/codex-templates`継続利用と自動移動/削除なしをテストで検証できる

## 🔗依存関係

- DependsOn: AGENT-001, AGENT-002, AGENT-003, META-001, SYNC-001

## 🧪テスト観点

- (ユニット / 統合 / E2E)
- 検証方法：
  - 仕様変更で追加した分岐（Agent管理・メタ移行）を中心に正常系/異常系を網羅確認する。

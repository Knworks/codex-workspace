---
id: `HIST-002`
title: `rollout JSONL解析と履歴インデックス生成`
status: Done
---

# 🧾`HIST-002 rollout JSONL解析と履歴インデックス生成`

## 🎯背景/目的

- 履歴ビューで必要な情報だけを安全に抽出し、年/月/日ツリーとセッションカードへ一貫したデータを供給する。

## 📌要件

- データソースは `$CODEX_HOME/sessions/.../rollout-*.jsonl` のみを使用する。
- 抽出対象は `user_message` と `task_complete.last_agent_message` のみとする。
- 日付階層（年/月/日）と同日内の新しい順ソートを提供する。

## 🛠️スコープ / 作業内容

- セッションディレクトリ走査と `rollout-*.jsonl` 収集処理を実装する。
- イベント抽出器を実装し、最初の `user_message`（タイトル/時刻）と最終回答を生成する。
- ローカル時刻 `[H:mm:ss]` 変換と、日付キー単位のインデックス構築を実装する。

## ✅AC（受け入れ基準）

- AC：必要十分な項目数（最低3、目安5〜10、上限なし）
  - [x] [機能] `$CODEX_HOME/sessions/年/月/日/rollout-*.jsonl` を走査してセッション一覧を生成できる
  - [x] [機能] カードタイトルが最初の `user_message` で生成される
  - [x] [機能] `task_complete.last_agent_message` を最終回答として取得できる
  - [x] [UI/UX] カード時刻がローカル時刻 `[H:mm:ss]` で表示可能な形式で提供される
  - [x] [テスト] 抽出対象限定、ソート、日付ツリー生成のユニットテストが追加される

## 🔗依存関係

- DependsOn: HIST-001

## 🧪テスト観点

- ユニット / リクエスト
- 検証方法：
  - サンプル JSONL 入力から抽出結果・ソート順・除外イベントを検証する

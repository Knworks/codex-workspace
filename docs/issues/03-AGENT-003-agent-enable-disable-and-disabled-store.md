---
id: `AGENT-003`
title: `Agent有効無効切替と退避復元`
status: Todo
---

# 🧾`AGENT-003 Agent有効無効切替と退避復元`

## 🎯背景/目的

- Agentの有効/無効を安全に切り替えられるようにし、既存コメントを含む`config.toml`ブロック情報を保持して復元可能にする。

## 📌要件

- Agent Explorerのコンテキストメニューに「Agentを有効化」「Agentを無効化」を追加する。
- 無効化時は`config.toml`の`[agents.<agent>]`を削除し、削除ブロックを`.codex/.codex-workspace/agents-disabled.json`へ退避する。
- 有効化時は退避ブロックを復元し、退避が無い場合は最小構成ブロックを追加する。

## 🛠️スコープ / 作業内容

- Agent有効化/無効化コマンドとコンテキストメニュー表示条件を実装する。
- `agents-disabled.json`の読み書き処理を実装する（辞書構造、version管理）。
- ブロック退避時にコメントを含む生テキストを保持する。
- 切替後に再起動が必要な旨の通知を追加する。

## ✅AC（受け入れ基準）

- AC：必要十分な項目数（最低3、目安5〜10、上限なし）
  - [ ] [機能] Agentノードのコンテキストメニューから有効化/無効化を実行できる
  - [ ] [機能] 無効化時に`config.toml`から`[agents.<agent>]`が削除される
  - [ ] [機能] 無効化時に削除ブロック（コメント含む）が`agents-disabled.json`へ保存される
  - [ ] [機能] 有効化時に退避ブロックが存在すればその内容で復元される
  - [ ] [機能] 退避ブロックが無い場合は最小構成ブロックが追加される
  - [ ] [UI/UX] 切替成功後に再起動が必要な旨の通知が表示される
  - [ ] [テスト] 退避/復元と最小構成フォールバックのテストが追加される

## 🔗依存関係

- DependsOn: AGENT-002

## 🧪テスト観点

- (ユニット / 統合)
- 検証方法：
  - ブロック削除・復元、コメント保持、退避未存在時のフォールバック、通知表示を確認する。

---
id: `META-001`
title: `メタ配置統一と同期メタ移行`
status: Todo
---

# 🧾`META-001 メタ配置統一と同期メタ移行`

## 🎯背景/目的

- 拡張機能メタファイルの配置を統一し、既存ユーザーの同期状態を失わずに新保存先へ移行する。

## 📌要件

- 拡張機能メタファイルの固定ルートを`.codex/.codex-workspace/`に統一する。
- 同期メタ保存先を`.codex/.codex-workspace/codex-sync.json`へ変更する。
- 新保存先優先・旧保存先互換の読み取りと、旧→新の原子的移行を実装する。

## 🛠️スコープ / 作業内容

- 同期メタ読み書きの保存先を`.codex/.codex-workspace/codex-sync.json`へ切り替える。
- 読み取り優先順（新→旧）を実装する。
- 旧のみ存在時にテンポラリファイル経由で新保存先へ移行し、再読み込み検証後に旧`state.json`を削除する。
- 移行失敗時は旧を保持し、処理中断とエラー通知を実装する。
- 同期対象除外パスを`.codex/.codex-workspace`へ更新する。

## ✅AC（受け入れ基準）

- AC：必要十分な項目数（最低3、目安5〜10、上限なし）
  - [ ] [機能] 同期メタが`.codex/.codex-workspace/codex-sync.json`へ保存される
  - [ ] [機能] 読み取り優先順が新保存先→旧保存先になっている
  - [ ] [機能] 新が無く旧がある場合に旧から新へ原子的に移行される
  - [ ] [機能] 移行成功時に旧`.codex/.codex-sync/state.json`が削除される
  - [ ] [状態/エラー] 移行失敗時は旧ファイルが保持され、処理が中断される
  - [ ] [機能] 同期対象除外パスが`.codex/.codex-workspace`に更新される
  - [ ] [テスト] 正常移行/失敗時ロールバック/優先読取のテストが追加される

## 🔗依存関係

- DependsOn: なし

## 🧪テスト観点

- (ユニット / 統合)
- 検証方法：
  - 新旧メタ存在パターンごとの読取結果、移行処理の原子性、失敗時挙動を確認する。

---
id: `TEST-001`
title: `会話履歴機能のテスト追加`
status: Done
---

# 🧾`TEST-001 会話履歴機能のテスト追加`

## 🎯背景/目的

- 仕様変更で追加される履歴機能の回帰を防ぎ、既存機能非影響を継続的に検証できる状態を作る。

## 📌要件

- 履歴ビュー起動導線、単一インスタンス、データ抽出、検索挙動のテストを追加する。
- `task_started/task_complete` 境界、`turn_id` フォールバック、`task_complete` 欠落時の確定を検証する。
- `maxHistoryCount` と `incrudeReasoningMessage` の設定反映を検証する。
- 既存 Explorer/同期機能の非回帰観点を追加する。

## 🛠️スコープ / 作業内容

- 履歴関連サービスのユニットテストを追加する。
- WebView 連携の統合テストを追加する。
- 設定値に応じた一覧制御・表示制御のテストを追加する。
- 既存テスト群に非回帰ケース（既存コマンド/ビュー表示）を追加する。

## ✅AC（受け入れ基準）

- AC：必要十分な項目数（最低3、目安5〜10、上限なし）
  - [x] [機能] 履歴ボタン/コマンドの双方で履歴ビュー起動テストが通過する
  - [x] [機能] 抽出対象が `user_message` / `agent_message` / `response_item.reasoning` に限定される
  - [x] [機能] `task_started/task_complete` の同一 `turn_id` でタスクが構築される
  - [x] [機能] `task_complete` 欠落時にアクティブタスクが確定される
  - [x] [機能] 検索実行とクリアで一覧状態が正しく遷移する
  - [x] [UI/UX] ローカル時刻表示とテーマ追従ハイライトの確認ケースがある
  - [x] [UI/UX] `incrudeReasoningMessage` の ON/OFF で思考過程表示が切り替わる
  - [x] [テスト] `maxHistoryCount` による表示件数制御のテストがある
  - [x] [テスト] 既存 Explorer と同期機能の主要ケースに回帰がない

## 🔗依存関係

- DependsOn: HIST-001, HIST-002, HIST-003

## 🧪テスト観点

- ユニット / 統合 / E2E
- 検証方法：
  - CI で履歴関連テストと既存テストを同時実行し、仕様準拠と非回帰を確認する
